Large Scale Code Embedding with Applications to Feature Selection and
Knowledge Discovery in Electronic Health Records
================

## Overview

The increasing availability of Electronic Health Record (EHR) systems
has created enormous potential for translational research. While the
huge amount of information in EHR can be used in clinical informatics
tasks, data mining for EHR data with complex structure is challenging.
Traditional data mining approaches require domain knowledge to select
relevant codes, which hampers the efficiency for translational research.
In this project, we aim to using large scale code embeddings to
facilitate effective feature selection and knowledge discovery with EHR
data.

## Installation

Install development version from GitHub.

``` r
# install.packages("remotes")
remotes::install_github("celehs/embedFS")
```

Load the package into
R.

``` r
library(embedFS)
```

## Example

``` r
library(data.table)
```

``` r
data <- readRDS(url("https://github.com/celehs/embedFS/raw/master/embed/embed.rds", "rb"))
str(data)
```

    ## List of 7
    ##  $ cos.sim:'data.frame': 203 obs. of  2 variables:
    ##   ..$ feature.list1: chr [1:203] "CCS:142" "CCS:143" "CCS:152" "CCS:153" ...
    ##   ..$ cos.sims     : num [1:203] 0.113 0.03 0.116 0.105 0.131 ...
    ##  $ x.full : num [1:1400, 1:203] -0.5279 0.0589 0.0555 -0.1405 0.1265 ...
    ##   ..- attr(*, "dimnames")=List of 2
    ##   .. ..$ : NULL
    ##   .. ..$ : chr [1:203] "CCS:142" "CCS:143" "CCS:152" "CCS:153" ...
    ##  $ x.train: num [1:1400, 1:203] 4.64e-01 -1.13e-01 -2.53e-02 -1.11e-15 -1.27e-01 ...
    ##   ..- attr(*, "dimnames")=List of 2
    ##   .. ..$ : NULL
    ##   .. ..$ : chr [1:203] "CCS:142" "CCS:143" "CCS:152" "CCS:153" ...
    ##  $ x.valid: num [1:1400, 1:203] -4.86e-01 -1.05e-01 -1.89e-02 -4.27e-16 -1.12e-01 ...
    ##   ..- attr(*, "dimnames")=List of 2
    ##   .. ..$ : NULL
    ##   .. ..$ : chr [1:203] "CCS:142" "CCS:143" "CCS:152" "CCS:153" ...
    ##  $ y.full : num [1:1400] -0.6533 0.0791 0.1126 -0.0566 -0.1325 ...
    ##  $ y.train: num [1:1400] 5.83e-01 -1.60e-01 -3.59e-02 6.18e-17 2.08e-02 ...
    ##  $ y.valid: num [1:1400] -6.35e-01 -1.46e-01 -2.73e-02 6.35e-16 1.48e-01 ...

``` r
embedFS:::feature.sel.fun(
  data$x.full, data$y.full, 
  data$x.train, data$y.train, 
  data$x.valid, data$y.valid, 
  method = "lasso", alpha = 0.5, cos.cut = 0.1)
```

    ##           variable  cos.sims   coefficient
    ## 124 RXNORM:1357536 0.7048314  0.7607397497
    ## 166  RXNORM:819300 0.6207658  0.2290020703
    ## 152  RXNORM:614391 0.5471694  0.1511359166
    ## 154    RXNORM:6851 0.5127502  0.0464526067
    ## 136   RXNORM:27169 0.5068817  0.0905647369
    ## 160   RXNORM:72435 0.4974620  0.0000000000
    ## 151  RXNORM:612865 0.4602235  0.1946176788
    ## 129  RXNORM:214555 0.4333576  0.0699112968
    ## 148    RXNORM:5521 0.4149958  0.0875045403
    ## 158  RXNORM:709271 0.4091133  0.0788900708
    ## 76   PheCode:714.2 0.4050517  0.0851209081
    ## 171    RXNORM:9524 0.3448767  0.0013600712
    ## 27   LOINC:32218-0 0.3440106  0.1212046901
    ## 139  RXNORM:327361 0.3263098  0.0586880724
    ## 146    RXNORM:4980 0.3255913  0.1365054521
    ## 78   PheCode:716.1 0.2798592  0.0331668803
    ## 138   RXNORM:31448 0.2795186  0.0143273029
    ## 144    RXNORM:4511 0.2788260 -0.0330358276
    ## 14   LOINC:11039-5 0.2786676 -0.0428134770
    ## 163   RXNORM:73056 0.2778091  0.0101049784
    ## 5          CCS:155 0.2679009  0.0000000000
    ## 118   RXNORM:10237 0.2663063  0.0748486583
    ## 126  RXNORM:191831 0.2574190  0.0557723293
    ## 28   LOINC:33935-8 0.2531465  0.0286731631
    ## 168    RXNORM:8640 0.2453293 -0.1028665603
    ## 77   PheCode:715.2 0.2449800  0.0423727562
    ## 167    RXNORM:8356 0.2441733  0.0561997976
    ## 26   LOINC:30522-7 0.2416009  0.0000000000
    ## 63   PheCode:696.4 0.2412040 -0.0200514573
    ## 80     PheCode:717 0.2385058  0.0144747047
    ## 79   PheCode:716.9 0.2361291  0.0349091374
    ## 103  PheCode:743.1 0.2304595  0.0514385044
    ## 145   RXNORM:46041 0.2292876  0.0396699902
    ## 170    RXNORM:8948 0.2257953  0.0022053123
    ## 85   PheCode:726.1 0.2254162  0.0139244811
    ## 74   PheCode:709.7 0.2252175  0.0000000000
    ## 98   PheCode:740.2 0.2252041  0.0082760908
    ## 73   PheCode:709.6 0.2232301  0.0479605286
    ## 120   RXNORM:10689 0.2221573  0.0000000000
    ## 161    RXNORM:7258 0.2183701  0.0000000000
    ## 134  RXNORM:232158 0.2171514  0.0515292412
    ## 97   PheCode:740.1 0.2140409  0.0163348098
    ## 88   PheCode:727.1 0.2134537  0.0360467287
    ## 33    LOINC:4537-7 0.2111283 -0.0156105592
    ## 143   RXNORM:41493 0.2094341  0.0000000000
    ## 70   PheCode:709.2 0.2092856  0.0348865076
    ## 66   PheCode:701.1 0.2075012  0.0561877235
    ## 65     PheCode:700 0.2063598  0.0225177628
    ## 125  RXNORM:140587 0.2060299  0.0296698517
    ## 99   PheCode:740.9 0.2055957 -0.0047046154
    ## 93   PheCode:735.2 0.2038996  0.0276983509
    ## 94   PheCode:735.3 0.2017043  0.0098730560
    ## 101  PheCode:741.4 0.2001695  0.0180877857
    ## 137   RXNORM:28889 0.1985218  0.0000000000
    ## 54     PheCode:351 0.1970164  0.0344413793
    ## 44   LOINC:X1166-8 0.1944314  0.0000000000
    ## 57   PheCode:443.1 0.1873359  0.0101515433
    ## 113    PheCode:770 0.1849594  0.0000000000
    ## 127  RXNORM:214159 0.1838368  0.0446956807
    ## 68   PheCode:703.1 0.1819675  0.0234644844
    ## 19   LOINC:15205-8 0.1809666  0.0140399204
    ## 36    LOINC:5130-0 0.1732381  0.0000000000
    ## 133  RXNORM:225852 0.1730655  0.0000000000
    ## 15   LOINC:11090-8 0.1709370  0.0000000000
    ## 72   PheCode:709.4 0.1708802  0.0149840587
    ## 82   PheCode:721.1 0.1689568  0.0000000000
    ## 62   PheCode:695.4 0.1684841  0.0002909665
    ## 140    RXNORM:3355 0.1684642  0.0008855453
    ## 169    RXNORM:8785 0.1661417  0.0255595151
    ## 105  PheCode:743.9 0.1652887  0.0000000000
    ## 116    PheCode:858 0.1632747  0.0397889311
    ## 87   PheCode:726.4 0.1607749  0.0266160899
    ## 156    RXNORM:6902 0.1566614  0.0000000000
    ## 58   PheCode:446.5 0.1555962  0.0000000000
    ## 159   RXNORM:72143 0.1549109  0.0000000000
    ## 31    LOINC:4532-8 0.1544082  0.0153695791
    ## 24   LOINC:17792-3 0.1542555  0.0000000000
    ## 112    PheCode:769 0.1531510  0.0583496560
    ## 119  RXNORM:106467 0.1491899  0.0000000000
    ## 23   LOINC:17791-5 0.1486366  0.0000000000
    ## 67   PheCode:702.4 0.1486237  0.0454228282
    ## 6          CCS:156 0.1481912  0.0000000000
    ## 86   PheCode:726.3 0.1473921  0.0091897877
    ## 25   LOINC:29953-7 0.1467291  0.0002858556
    ## 81   PheCode:720.1 0.1465564  0.0000000000
    ## 39    LOINC:5781-0 0.1455599  0.0000000000
    ## 106    PheCode:745 0.1455307 -0.0618534603
    ## 49   PheCode:274.2 0.1449438  0.0236468216
    ## 110    PheCode:764 0.1436379  0.0220821574
    ## 128  RXNORM:214182 0.1430483 -0.0232120017
    ## 8          CCS:163 0.1424506  0.0000000000
    ## 84   PheCode:722.6 0.1416126  0.0000000000
    ## 141   RXNORM:35780 0.1410338  0.0000000000
    ## 153    RXNORM:6759 0.1401837  0.0017362452
    ## 59     PheCode:502 0.1400129  0.0338811643
    ## 45     PheCode:010 0.1375066  0.0501449389
    ## 35    LOINC:5048-4 0.1345644  0.0000000000
    ## 92   PheCode:733.8 0.1332082  0.0456858840
    ## 40    LOINC:6698-5 0.1324592  0.0000000000
    ## 100  PheCode:741.2 0.1321947  0.0000000000
    ## 130  RXNORM:215830 0.1318863  0.0000000000
    ## 51   PheCode:279.7 0.1315922  0.0005226489
    ## 4          CCS:154 0.1314738  0.0000000000
    ## 75   PheCode:711.1 0.1314276  0.0208996633
    ## 121   RXNORM:11253 0.1311381  0.0000000000
    ## 135  RXNORM:258337 0.1307832  0.0000000000
    ## 17   LOINC:14611-8 0.1306656  0.0000000000
    ## 132   RXNORM:21949 0.1305342  0.0000000000
    ## 53   PheCode:338.2 0.1305039  0.0000000000
    ## 10         CCS:182 0.1304141  0.0016318073
    ## 107    PheCode:760 0.1302290 -0.0049588339
    ## 102  PheCode:742.9 0.1301086  0.0000000000
    ## 48   PheCode:244.4 0.1294766  0.0000000000
    ## 131  RXNORM:215831 0.1292452  0.0000000000
    ## 142    RXNORM:4100 0.1289229  0.0000000000
    ## 104  PheCode:743.2 0.1287765  0.0317230833
    ## 90   PheCode:728.7 0.1285848  0.0000000000
    ## 89   PheCode:727.6 0.1281846  0.0000000000
    ## 157     RXNORM:704 0.1256459  0.0000000000
    ## 162   RXNORM:72625 0.1247609  0.0000000000
    ## 108    PheCode:761 0.1246359  0.0000000000
    ## 115    PheCode:809 0.1237827  0.0000000000
    ## 42   LOINC:74278-3 0.1235338  0.0000000000
    ## 165  RXNORM:817579 0.1227345  0.0050727096
    ## 64     PheCode:697 0.1218670  0.0000000000
    ## 95   PheCode:737.1 0.1197850  0.0149142830
    ## 71   PheCode:709.3 0.1192999  0.0000000000
    ## 7          CCS:162 0.1186845  0.0000000000
    ## 69   PheCode:707.2 0.1184138  0.0239865154
    ## 96     PheCode:739 0.1181297  0.0215499837
    ## 55   PheCode:371.1 0.1168923  0.0000000000
    ## 16   LOINC:12201-0 0.1164587  0.0046233479
    ## 11         CCS:224 0.1157437 -0.0012353733
    ## 32   LOINC:45323-3 0.1156259  0.0081308614
    ## 2          CCS:152 0.1155223  0.0000000000
    ## 41    LOINC:6968-2 0.1139698  0.0073890523
    ## 34   LOINC:46267-1 0.1139698  0.0075048285
    ## 20   LOINC:17316-1 0.1137950  0.0074034377
    ## 52   PheCode:333.2 0.1136313  0.0271312400
    ## 147    RXNORM:5487 0.1133086 -0.0127834091
    ## 1          CCS:142 0.1128322  0.0021684252
    ## 13         CCS:228 0.1116026  0.0000000000
    ## 18   LOINC:15174-6 0.1106018  0.0000000000
    ## 109    PheCode:763 0.1100598  0.0000000000
    ## 43    LOINC:8093-7 0.1099568  0.0000000000
    ## 56   PheCode:375.1 0.1093923  0.0238455197
    ## 150    RXNORM:6038 0.1085035  0.0000000000
    ## 164   RXNORM:77655 0.1072301  0.0066560119
    ## 61   PheCode:681.1 0.1063583  0.0040753586
    ## 38   LOINC:53704-3 0.1062209  0.0084696841
    ## 114  PheCode:771.1 0.1060442  0.0000000000
    ## 9          CCS:170 0.1054684  0.0000000000
    ## 3          CCS:153 0.1052512  0.0027450281
    ## 47   PheCode:110.1 0.1044772  0.0000000000
    ## 50   PheCode:279.2 0.1042388  0.0000000000
    ## 117    PheCode:977 0.1042113  0.0281205796
    ## 60   PheCode:627.2 0.1037890  0.0208270605
    ## 37    LOINC:5348-8 0.1035378  0.0000000000
    ## 22   LOINC:17789-9 0.1032867  0.0000000000
    ## 46     PheCode:031 0.1031625  0.0213802495
    ## 149    RXNORM:5781 0.1028317  0.0000000000
    ## 91   PheCode:729.1 0.1027694  0.0000000000
    ## 155     RXNORM:689 0.1026533 -0.0005683082
    ## 83   PheCode:721.2 0.1014055  0.0000000000
    ## 30    LOINC:4498-2 0.1012336  0.0000000000
    ## 12         CCS:226 0.1011793 -0.0123309963
    ## 122  RXNORM:119565 0.1010796  0.0000000000
    ## 111    PheCode:765 0.1006167  0.0000000000
    ## 21   LOINC:17788-1 0.1004058  0.0000000000
    ## 29    LOINC:4485-9 0.1000725  0.0000000000
    ## 123  RXNORM:121191 0.1000094  0.0000000000
